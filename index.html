<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>Ø¨Ø§Ø²ÛŒ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒØ¯Ø§Ø±ÛŒ</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f5f5f5;
      text-align: center;
    }
    .player {
      border: 2px solid #333;
      border-radius: 12px;
      padding: 10px;
      margin: 10px;
      display: inline-block;
      background-color: #ffffff;
      width: 200px;
      position: relative;
    }
    .status {
      position: absolute;
      top: 5px;
      right: 5px;
      font-size: 18px;
    }
    .log {
      background-color: #eaeaea;
      max-height: 200px;
      overflow-y: auto;
      padding: 10px;
      margin: 20px auto;
      width: 90%;
      text-align: right;
    }
    .buttons {
      margin-top: 10px;
    }
    button {
      margin: 2px;
      padding: 5px 10px;
    }
    input[type="text"] {
      width: 120px;
      margin: 5px;
    }
    .rich {
      background-color: #e0ffe0;
    }
    .poor {
      background-color: #ffe0e0;
    }
    .enslaved {
      background-color: #fff0c0;
    }
    .turn {
      border: 3px solid #0000ff;
    }
  </style>
</head>
<body>
  <img src="https://cdn.imgurl.ir/uploads/b12534_unnamed.png" alt="Ù„ÙˆÚ¯ÙˆÛŒ Ø¨Ø§Ø²ÛŒ" style="width: 180px; display: block; margin: 0 auto 20px;" />
  <h1>Ø¨Ø§Ø²ÛŒ Ø³Ú©Ù‡ Ø¯Ù‡ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ† ØªÙÚ© ØªÙÚ©</h1>
  <div id="setup">
    <h2>Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†</h2>
    <input type="text" id="newPlayer" placeholder="Ù†Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù†">
    <button onclick="addPlayer()">â• Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ø§Ø²ÛŒÚ©Ù†</button>
    <button onclick="startGame()">ğŸ² Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</button>
    <div id="playerList"></div>
  </div>
  <div id="game" style="display: none;">
    <hr style="border: none; border-top: 2px solid #000; margin: 20px 0;">
    <img src="https://cdn.imgurl.ir/uploads/z210539_favpng_bb07d783b2a7e23a3a861d784dd01b41.png" alt="Ù„ÙˆÚ¯ÙˆÛŒ Ø¨Ø§Ù†Ú©" style="width: 50px; display: block; margin: 0 auto 5px;" />
    <div id="bank">ğŸ› Ø¨Ø§Ù†Ú© Ø³Ù„Ø·Ù†ØªÛŒ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù…Ù„Ú©ÛŒØ§Ù†Ø³ : <span id="bankCoins">111</span> Ø³Ú©Ù‡ ğŸ›</div>
    <h3>Ù†ÙˆØ¨Øª: <span id="currentPlayerName"></span></h3>
    <div id="players"></div>
    <div class="log" id="log"></div>
  </div>
  <script>
    let players = [];
    let bankCoins = 111;
    let currentPlayerIndex = 0;
    let loanTimers = {};

    function addPlayer() {
      const name = document.getElementById('newPlayer').value.trim();
      if (name && players.length < 10) {
        players.push({ name, coins: 10, debt: 0, enslavedTo: null, isCapitalist: false });
        document.getElementById('newPlayer').value = '';
        renderPlayerList();
      }
    }

    function renderPlayerList() {
      const div = document.getElementById('playerList');
      div.innerHTML = players.map(p => `<p>${p.name}</p>`).join('');
    }

    function startGame() {
      if (players.length >= 2) {
        document.getElementById('setup').style.display = 'none';
        document.getElementById('game').style.display = 'block';
        renderPlayers();
        updateTurnDisplay();
      } else {
        alert('Ø­Ø¯Ø§Ù‚Ù„ Ø¯Ùˆ Ø¨Ø§Ø²ÛŒÚ©Ù† Ù†ÛŒØ§Ø² Ø§Ø³Øª.');
      }
    }

    function renderPlayers() {
      const container = document.getElementById('players');
      container.innerHTML = '';

      players.forEach((player, i) => {
        const div = document.createElement('div');
        let className = 'player';

        if (player.coins === 0 && player.enslavedTo === null) className += ' poor';
        else if (player.enslavedTo !== null) className += ' enslaved';
        else className += ' rich';

        if (i === currentPlayerIndex) className += ' turn';
        div.className = className;

        let statusIcons = '';
        if (player.debt > 0) statusIcons += 'ğŸ›';
        if (player.enslavedTo !== null) statusIcons += 'âš’';
        if (player.isCapitalist) statusIcons += 'ğŸ©';

        let options = '';

        if (i === currentPlayerIndex) {
          const current = players[i];

          players.forEach((_, j) => {
            if (i !== j) {
              options += `<button onclick="giveCoin(${i}, ${j})">ğŸ” Ø³Ú©Ù‡ Ø¨Ù‡ ${players[j].name}</button>`;
            }
          });

          let enslaveBtn = '';
          if (current.coins > 0) {
            players.forEach((target, tIndex) => {
              if (target.coins === 0 && target.enslavedTo === null) {
                enslaveBtn += `<button onclick="enslave(${i}, ${tIndex})">ğŸ§· Ú©Ø§Ù¾ÛŒØªØ§Ù„ÛŒØ³Ù… ${target.name}</button>`;
              }
            });
          }

          let freeBtn = '';
          if (current.isCapitalist) {
            players.forEach((target, tIndex) => {
              if (target.enslavedTo === i) {
                freeBtn += `<button onclick="freeSlave(${i}, ${tIndex})">ğŸ” Ø¢Ø²Ø§Ø¯ Ú©Ø±Ø¯Ù† ${target.name}</button>`;
              }
            });
          }

          options += `
            <input type="number" id="loanAmount" placeholder="Ù…Ù‚Ø¯Ø§Ø± ÙˆØ§Ù…">
            <button onclick="getLoan(${i})">ğŸ“¥ Ú¯Ø±ÙØªÙ† ÙˆØ§Ù…</button>
            <button onclick="payBack(${i})">ğŸ’¸ ØªØ³ÙˆÛŒÙ‡ Ø¨Ø¯Ù‡ÛŒ</button>
            <button onclick="giveCoinToBank(${i})">ğŸ¦ Ø¯Ø§Ø¯Ù† Ø³Ú©Ù‡ Ø¨Ù‡ Ø¨Ø§Ù†Ú©</button>
            ${enslaveBtn}
            ${freeBtn}
            <button onclick="skipTurn()">ğŸš« Ø³Ú©Ù‡ Ù†Ù…ÛŒâ€ŒØ¯Ù‡Ù…</button>
          `;
        } else {
          // Allow bankrupt players to still take actions
          options += `<button onclick="getLoan(${i})">ğŸ“¥ Ú¯Ø±ÙØªÙ† ÙˆØ§Ù…</button>`;
          options += `<button onclick="giveCoinToBank(${i})">ğŸ¦ Ø¯Ø§Ø¯Ù† Ø³Ú©Ù‡ Ø¨Ù‡ Ø¨Ø§Ù†Ú©</button>`;
        }

        div.innerHTML = `
          <div class="status">${statusIcons}</div>
          <strong>${player.name}</strong><br>
          ğŸ’° ${player.coins} Ø³Ú©Ù‡<br>
          Ø¨Ø¯Ù‡ÛŒ: ${player.debt}<br>
          <div class="buttons">${options}</div>
        `;

        container.appendChild(div);
      });

      document.getElementById('bankCoins').textContent = bankCoins;
    }

    function logAction(msg) {
      const log = document.getElementById('log');
      const p = document.createElement('p');
      p.textContent = msg;
      log.prepend(p);
    }

    function giveCoin(from, to) {
      const fromPlayer = players[from];
      const toPlayer = players[to];
      const amount = prompt('Ù…Ù‚Ø¯Ø§Ø± Ø³Ú©Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:');
      if (amount && from === currentPlayerIndex && fromPlayer.coins >= amount) {
        fromPlayer.coins -= amount;
        toPlayer.coins += parseInt(amount);
        logAction(`${fromPlayer.name} Ø¨Ù‡ ${toPlayer.name} ${amount} Ø³Ú©Ù‡ Ø¯Ø§Ø¯.`);
        nextTurn();
      }
    }

    function giveCoinToBank(index) {
      const player = players[index];
      const amount = prompt('Ù…Ù‚Ø¯Ø§Ø± Ø³Ú©Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ù‡ Ø¨Ø§Ù†Ú© Ø¨Ø¯Ù‡ÛŒØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:');
      const coinAmount = parseInt(amount);

      if (!isNaN(coinAmount) && coinAmount > 0 && player.coins >= coinAmount && index === currentPlayerIndex) {
        player.coins -= coinAmount;
        bankCoins += coinAmount;
        logAction(`${player.name} ${coinAmount} Ø³Ú©Ù‡ Ø¨Ù‡ Ø¨Ø§Ù†Ú© Ø¯Ø§Ø¯.`);
        nextTurn();
      } else {
        alert('Ù…Ù‚Ø¯Ø§Ø± Ù†Ø§Ù…Ø¹ØªØ¨Ø± ÛŒØ§ Ø³Ú©Ù‡ Ú©Ø§ÙÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯.');
      }
    }

    function getLoan(index) {
      const amount = parseInt(document.getElementById('loanAmount').value);
      if (index === currentPlayerIndex && bankCoins >= amount && amount > 0) {
        players[index].coins += amount;
        players[index].debt += amount;
        bankCoins -= amount;
        logAction(`${players[index].name} ÙˆØ§Ù… ${amount} Ø³Ú©Ù‡â€ŒØ§ÛŒ Ú¯Ø±ÙØª. Ø¨Ø§Ø²Ù¾Ø±Ø¯Ø§Ø®Øª ØªØ§ 5 Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¯ÛŒÚ¯Ø±.`);
        startLoanTimer(index);
        nextTurn();
      }
    }

    function startLoanTimer(index) {
      if (loanTimers[index]) clearTimeout(loanTimers[index]);
      loanTimers[index] = setTimeout(() => {
        const player = players[index];
        if (player.debt > 0) {
          if (player.coins >= player.debt) {
            player.coins -= player.debt;
            bankCoins += player.debt;
            logAction(`â° Ø¨Ø§Ù†Ú© Ø¨Ø¯Ù‡ÛŒ ${player.name} Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø±Ø¯Ø§Ø´Øª.`);
          } else {
            logAction(`ğŸ’¥ ${player.name} Ù†ØªÙˆØ§Ù†Ø³Øª Ø¨Ø¯Ù‡ÛŒ Ø±Ø§ Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ù†Ø¯ Ùˆ ÙˆØ±Ø´Ú©Ø³ØªÙ‡ Ø´Ø¯.`);
            players.forEach(p => {
              if (p.enslavedTo === index) {
                p.enslavedTo = null;
                logAction(`ğŸ’¼ ${p.name} Ø§Ø² Ø³Ù„Ø·Ù‡ ${player.name} Ø¢Ø²Ø§Ø¯ Ø´Ø¯.`);
              }
            });
            player.isCapitalist = false; // Ø­Ø°Ù ğŸ© Ø¯Ø± ØµÙˆØ±Øª ÙˆØ±Ø´Ú©Ø³ØªÚ¯ÛŒ
          }
          player.debt = 0;
          renderPlayers();
        }
      }, 300000);
    }

    function payBack(index) {
      const player = players[index];
      if (index === currentPlayerIndex && player.coins >= player.debt && player.debt > 0) {
        player.coins -= player.debt;
        bankCoins += player.debt;
        player.debt = 0;
        clearTimeout(loanTimers[index]);
        logAction(`${player.name} Ø¨Ø¯Ù‡ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ø±Ø¯.`);
        nextTurn();
      }
    }

    function enslave(masterIndex, targetIndex) {
      const master = players[masterIndex];
      const slave = players[targetIndex];
      if (masterIndex === currentPlayerIndex && bankCoins >= 10 && slave.coins === 0 && slave.enslavedTo === null) {
        master.coins += 5;
        slave.coins += 5;
        slave.enslavedTo = masterIndex;
        bankCoins -= 10;
        master.isCapitalist = true;
        logAction(`${master.name}ØŒ ${slave.name} Ø±Ø§ ØªØ­Øª Ø³Ù„Ø·Ù‡ Ø¯Ø±Ø¢ÙˆØ±Ø¯ Ùˆ Ù‡Ø± Ø¯Ùˆ Ûµ Ø³Ú©Ù‡ Ú¯Ø±ÙØªÙ†Ø¯.`);
        nextTurn();
      }
    }

    function freeSlave(masterIndex, targetIndex) {
      const master = players[masterIndex];
      const slave = players[targetIndex];
      if (master.isCapitalist && slave.enslavedTo === masterIndex) {
        slave.enslavedTo = null;
        master.coins -= 5; // Ú©Ø§Ù‡Ø´ Ø³Ú©Ù‡ Ø§Ø² Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒØ¯Ø§Ø±
        logAction(`${master.name} ${slave.name} Ø±Ø§ Ø¢Ø²Ø§Ø¯ Ú©Ø±Ø¯.`);
        nextTurn();
      }
    }

    function checkBankruptcy() {
      const player = players[currentPlayerIndex];
      if (player.coins === 0 && player.debt > 0) {
        logAction(`ğŸ’¥ ${player.name} ÙˆØ±Ø´Ú©Ø³ØªÙ‡ Ø´Ø¯!`);
        players.forEach(p => {
          if (p.enslavedTo === currentPlayerIndex) {
            p.enslavedTo = null;
            logAction(`ğŸ’¼ ${p.name} Ø§Ø² Ø³Ù„Ø·Ù‡ ${player.name} Ø¢Ø²Ø§Ø¯ Ø´Ø¯.`);
          }
        });
        player.isCapitalist = false; // Ø­Ø°Ù ğŸ© Ø¯Ø± ØµÙˆØ±Øª ÙˆØ±Ø´Ú©Ø³ØªÚ¯ÛŒ
        renderPlayers();
      }
    }

    function skipTurn() {
      logAction(`${players[currentPlayerIndex].name} Ø§ÛŒÙ† Ù†ÙˆØ¨Øª Ø±Ø§ Ø±Ø¯ Ú©Ø±Ø¯.`);
      nextTurn();
    }

    function nextTurn() {
      checkBankruptcy(); // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ±Ø´Ú©Ø³ØªÚ¯ÛŒ Ù‚Ø¨Ù„ Ø§Ø² ØªØºÛŒÛŒØ± Ù†ÙˆØ¨Øª
      do {
        currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
      } while (players[currentPlayerIndex].enslavedTo !== null);
      updateTurnDisplay();
      renderPlayers();
    }

    function updateTurnDisplay() {
      document.getElementById('currentPlayerName').textContent = players[currentPlayerIndex].name;
    }
  </script>
</body>
</html>
